<!DOCTYPE html>
    <html lang="en">
        <head>
            <meta charset="utf-8"/>
            <link rel="stylesheet" th:href="@{/stylesheet.css}" type="text/css"/>
            <title>Tool WareHouse Tools</title>
        </head>
        <body>
            <div th:if="${checkoutSuccess}">
                <div class = "success-alert" id = "indexSuccessAlert" style = "display:none;">
                    <p th:text="${alert_message}"></p>
                </div>
                <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
                <script>
                //When the page has loaded.
                $( document ).ready(function(){
                    $('#indexSuccessAlert').fadeIn('slow', function(){
                       $('#indexSuccessAlert').delay(3000).fadeOut(); 
                    });
                });
                </script>
            </div>

            <div class="header">
                <h1>TOOLS PAGE</h1>
                <img src="TheWarehouseLogo-FINAL2.png" alt="logo" style="width:300px;height:100px">
            </div>
            <header class ="testNavBar">
                <ul>
                    <li><a href="/signin">Sign In</a></li>
                    <li><a href="/signup">Sign up</a></li>
                    <li><a class="active" href="/tools">Tools</a></li>
                    <li><a href="/index">Home</a></li>
                    <li><a href="/checkout">Checkout</a></li>
                    <li><a href="/projects">Projects</a></li>
                    <li style="float:right"><a href="/contactus">Contact Us</a></li>
                </ul>
            </header>

            <div class="pageMethods">
                <div>
                    <button type="button" id="resetButton"> Reset Display </button>
                </div>
                <div>
                    <input type="text" id="searchBar">
                    <button type="button" id="searchGo"> Search</button>
                </div>
                <div>
                    <select id="filterBy">
                        <option value="InStock">In Stock</option>
                        <option value="Bike Tools">Bike Tools</option>
                        <option value="Carpentry & Woodworking">Carpentry & Woodworking</option>
                        <option value="Carpet Tools">Carpet Tools</option>
                        <option value="Cement Tools">Cement Tools</option>
                        <option value="Drywall & Masonry">Drywall & Masonry</option>
                        <option value="Electrical & Mechanical">Electrical & Mechanical</option>
                        <option value="Garden Tools">Garden Tools</option>
                        <option value="Kitchen Tools">Kitchen Tools</option>
                        <option value="Other Tools">Other Tools</option>
                        <option value="Power Tools">Power Tools</option>
                    </select>
                    <button type="button" id="filterGo">Filter</button>
                </div>
                    <select id="sortBy">
                        <option value="alpha"> Alphabetically </option>
                        <option value="quantity"> Quantity on Hand </option>
                    </select>
                    <button type="button" id="sortGo">Sort</button>
                </div>
            </div>

            <table align="center" id="toolTable">
            </table>

            <script th:inline="javascript">
                var list = /*[[${tools}]]*/;
                var table = document.getElementById("toolTable");


                var resetButton = document.getElementById("resetButton");
                resetButton.setAttribute("onclick", "initialize()");

                var searchFor = document.getElementById("searchBar");

                var searchButton = document.getElementById("searchGo");
                searchButton.setAttribute("onclick", "search(searchFor.value)");

                var filterBy = document.getElementById("filterBy");

                var filterButton = document.getElementById("filterGo");
                filterButton.setAttribute("onclick", "filterCategory(filterBy.value)");

                var sortBy = document.getElementById("sortBy");

                var sortButton = document.getElementById("sortGo");
                sortButton.setAttribute("onclick", "sortWrapper(sortBy.value)");


                initialize();


                function initialize(){
                    wipe();

                    for(var i in list){
                        addTool(list[i]);
                    }
                }

                function sortWrapper(sortType){
                    var passIn = 0;
                    if(sortType.localeCompare("alpha")){
                        passIn = 1;
                        sort(passIn);
                    }
                    else if(sortType.localeCompare("quantity")){
                        passIn = 2;
                        sort(passIn);
                    }
                    else{
                        console.log("Unknown sort type");
                    }
                }

                function sort(sortType){
                    var list1 = list.slice();

                    var sortedList=[];
                    for(var i in list1){
                        min = i;

                        for(var j=i; j<list1.length; j++){
                            if(sortType==2){
                                if( list1[min].name.localeCompare(list1[j].name) > 0){
                                    min = j;
                                }
                            }
                            else if(sortType==1){
                                if( list1[min].onHand < list1[j].onHand){
                                    min = j;
                                }
                            }
                            else{
                                console.log("no sorting is occurring")
                            }
                        }

                        var temp = list1[i];
                        list1[i] = list1[min];
                        list1[min] = temp;

                        sortedList.push(list1[i]);
                    }
                    wipe();
                    console.log(sortedList);
                    for(var k in sortedList){
                        addTool(sortedList[k]);
                    }
                }

                function filterCategory(category){
                    if(category.localeCompare("InStock")==0){
                        filterInStock();
                    }
                    else{
                        var filteredList = [];
                        for(var i in list){
                            var curTool = list[i];
                            if(curTool.category.localeCompare(category)==0){
                                filteredList.push(curTool);
                            }
                        }

                        if(filteredList.length==0){
                            alert("For some reason, no tools had the category " + category)
                        }
                        else{
                            wipe();
                            for(var i in filteredList){
                                addTool(filteredList[i]);
                            }
                        }
                    }
                }

                function filterInStock(){
                    var filteredList = [];
                    for(var i in list){
                        var curTool = list[i];
                        if(curTool.onHand > 0){
                            filteredList.push(curTool);
                        }
                    }

                    if(filteredList.length==0){
                        alert("No tools are in stock?!?!")
                    }
                    else{
                        wipe();
                        for(var i in filteredList){
                            addTool(filteredList[i]);
                        }
                    }
                }

                function search(toolName){
                    var searchedList = [];
                    for(var i in list){
                        var curTool = list[i];
                        if(curTool.name.toLowerCase().includes(toolName.toLowerCase())){
                            searchedList.push(curTool);
                        }
                    }

                    if(searchedList.length==0){
                        alert("No tools found containing " + toolName);
                    }
                    else{
                        wipe();
                        for(var i in searchedList){
                            addTool(searchedList[i]);
                        }
                    }
                }

                function wipe(){
                    var nextToDelete = table.lastElementChild;
                    while(nextToDelete){
                        nextToDelete.remove();
                        nextToDelete = table.lastElementChild;
                    }

                    var tableRow = document.createElement("tr");
                    table.appendChild(tableRow);

                    var td1 = document.createElement("td");
                    td1.innerHTML = "Category";
                    tableRow.appendChild(td1);

                    var td2 = document.createElement("td");
                    td2.innerHTML = "Name";
                    tableRow.appendChild(td2);

                    var td3 = document.createElement("td");
                    td3.innerHTML = "Value";
                    tableRow.appendChild(td3);

                    var td4 = document.createElement("td");
                    td4.innerHTML = "Quantity";
                    tableRow.appendChild(td4);

                    var td5 = document.createElement("td");
                    td5.innerHTML = "On Hand";
                    tableRow.appendChild(td5);

                    var td6 = document.createElement("td");
                    td6.innerHTML = "Checked Out";
                    tableRow.appendChild(td6);
                }

                function addTool(tool){

                    var tableRow = document.createElement("tr");
                    tableRow.setAttribute("class", "toolCell");
                    table.appendChild(tableRow);

                    var td1 = document.createElement("td");
                    td1.innerHTML = tool.category;
                    td1.setAttribute("class", "toolCell");
                    tableRow.appendChild(td1);

                    var td2 = document.createElement("td");
                    td2.innerHTML = tool.name;
                    td2.setAttribute("class", "toolCell");
                    tableRow.appendChild(td2);

                    var td3 = document.createElement("td");
                    td3.innerHTML = tool.value;
                    td3.setAttribute("class", "toolCell");
                    tableRow.appendChild(td3);

                    var td4 = document.createElement("td");
                    td4.innerHTML = tool.quantity;
                    td4.setAttribute("class", "toolCell");
                    tableRow.appendChild(td4);

                    var td5 = document.createElement("td");
                    td5.innerHTML = tool.onHand;
                    td5.setAttribute("class", "toolCell");
                    tableRow.appendChild(td5);

                    var td6 = document.createElement("td");
                    td6.innerHTML = tool.checkedOut;
                    td6.setAttribute("class", "toolCell");
                    tableRow.appendChild(td6);

                    <!--<td th:if="${signedIn}" class="toolCell">-->
                        <!--<form th:action="@{/customer/reserveTool}" th:object="${toolDto}" method="POST">-->
                            <!--<input type="hidden" th:name="id" th:value="${{tool.id}}">-->
                            <!--<button type="submit" th.text="#{label.form.submit}">Checkout</button>-->
                        <!--</form>-->
                    <!--</td>-->
                }
            </script>

                <p class="rightsReserved">All Rights Reserved. Group Name Inc.</p>
                <img src="TheWarehouseLogo-FINAL2.png" alt="logo" style="width:75px;height:25px">
        </body>
    </html>